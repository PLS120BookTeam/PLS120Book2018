---
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    theme: readable
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup0, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=FALSE, include=FALSE}
# load packages for chapter

options(digits = 10)
library(bookdown)
library(emmeans)
library(ggplot2)
library(dplyr)
library(kableExtra)
library(knitr)
library(tables)
library(pander)
library(multcomp)
library(agricolae)
library(nlme)
library(car)
library(tidyr)

```

# Two Populations Means {#ch.2pops}

## Learning Objectives for Chapter {#LearnObj8}

1. Compare two population means based on two samples.
1. Determine if samples are paired or unpaired ("independent") when comparing two means.
1. State the null and alternative hypothesis for a two sample t-test. 
1. Perform an F-test of homogeneity of variance using samples from two populations.
1. Describe the four cases for comparing two populations means and determine when each one applies for a problem.
1. After performing a two sample t test, sketch the t distribution, with the following parts labeled: 
  - the critical t value
  - the test statistic
  - the p value area under the curve.
  - the alpha level area under the curve. 
  - where the CI bounds would lie on the X axis (approximately)
1. Interpret the results of a t-test in terms of the original scientific question. 

## Two Populations {TwoPops}

We have learned in the previous chapters how to determine if a sample is significantly different from the population it belongs to.  However, researchers may want to know if two populations are significantly different from each other.  In research experiments, populations are considered distinct when there are unique treatments that are applied to them.  For example, one could conduct an experiment comparing a fertilized field to an unfertilized field to determine a difference in yield, or an experiment comparing a high-carbohydrate diet to a high-protein diet to determine a difference in milk quality among cows.  These experiments are conducted by taking samples from each of the populations and using the difference between the two samples to make inferences about the difference between the two treatments or the two populations.  

```{block, type = 'stattip'}
# Steps to Test Two Population Means
1. State the null and alternative hypotheses for the two populations
2. Collect samples from each population
3. Calculate the sample averages, $\bar{Y}_1$ and $\bar{Y}_2$, and the difference of the averages,$\bar{d}$
4. Calculate the sample variances, $S^2_1$ and $S^2_2$, and the standard error of the mean difference, $S_{\bar{d}}$, between the two samples 
  **It is important to identify the appropriate Case equations to apply to the samples in this step**
5. Calculate the t-statistic using the calculated $\bar{d}$ and $S_{\bar{d}}$
6. Compare the calculated t-statistic to the critical t-value, to decide to reject or fail to reject the null hypothesis
```

## Hypothesis Testing
Before all the calculations have begun, it is important to understand the aim of these calculations.  The purpose of testing two population means is to understand if there is a statistically significant difference between these two populations or two treatments.  Thus, our null  hypothesis and alternative hypothesis can be stated, respectively, as 

$$\text{Null hypothesis: the mean of population 1 is equal to the mean of population 2, or that there is no difference between the two population means} \\[15pt]$$
$H_0 : \mu_1 = \mu_2$         or       $\mu_{\bar{d}} = 0$

$$\text{Alternative hypothesis: the mean of population 1 is not equal to the mean of population 2, or that there is a difference between the two population means} \\[15pt]$$
$H_1 : \mu_1 \neq \mu_2$      or       $\mu_{\bar{d}} \neq 0$


## Sampling Methods

There are two different methods of sampling to compare treatment means: **independent** samples and **paired** or dependent samples.  

Samples are considered **independent** when there is no relationship between the observations in one treatment and the observations in the other treatment, and the samples are randomly assigned to a given treatment.  For example, pigs are randomly assigned to two different diets to measure the difference in body weight, and the difference between the two diet averages are measured.  Since there is no information of the relationship between the pigs in the two diet treatments and the pigs are randomly assigned to a diet, the assumption is that these samples (pigs) are independent of each other.  

 (Figure \@ref(fig:IndSamples))

```{r IndSamples, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = '60%', fig.align='center', echo=FALSE, fig.cap ="Independent samples of pigs are randomly placed into two treatments, where $\r$ is the number of samples per treatment, and $\i$ is the sample number for a given treatment"}

knitr::include_graphics("images/CH8IndSamp.png")

```

Samples are considered **paired** or dependent when there is a relationship between the observations in one treatment and the observations in the other treatment, and there is a direct comparison of the observations with the shared relationship.  Paired samples are made from the direct comparisons of two measurements made on the same experimental unit.  Individual pigs can be treated as experimental units if two measurements are collected on the same individual.  For example, to understand the effect of two different diets on pigs, an initial body weight measurement is collected on all pigs on standard high-carbohydrate diet.  Then following a set period of time on a high-protein diet, a second body weight measurement will be taken on all pigs.  The difference between the two diets are measured by collectively comparing the two body weight measurements for each pig (each experimental unit) involved in the study.

In some examples, restrictions may make it difficult to test two treatments on the same individual organism, however, understanding shared relationships between individual organisms may allow paired samples of separate individuals that are within the same experimental unit.  Pigs that are from the same pen share genetic and environmental effects that are unique to that pen, and we can treat individuals from the same pen as our experimental unit.  For example, two pigs from the same pen are assigned to different diets to measure the difference in body weight among all the paired pigs from the same pen.  The difference between the two diets are measured by collectively comparing the sets of pigs from the same pens.  In this example, the experimental unit is not individual pigs but the pens that the pair of pigs come from. 

```{r IndSamples, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = '60%', fig.align='center', echo=FALSE, fig.cap ="Paired samples of pigs from the same pen placed into two treatments, where $\r$ is the number of samples per treatment, and $\i$ is the sample number for a given treatment"}

knitr::include_graphics("images/CH8PairSamp.png")

```

It is important to understand how the two populations are created (through sampling) to decide which equations are appropriate for the experiment.  Using the incorrect equation may lead to incorrect calculations and conclusions, so take the time to understand the given parameters of the populations under evaluation.  

## Calculating the F-statistic

To understand the parameters of the two populations and to identify which Case is appropriate for later calculations, an F-test is used to determine if the population variances are equal or unequal.  With any test, it is important to state the null and alternative hypotheses

$$\text{Null hypothesis: the variance of population 1 is equal to the variance of population 2} \\[15pt]$$
$H_0 : \sigma_1 = \sigma_2$)

$$\text{Alternative hypothesis: the variance of population 1 is not equal to the variance of population 2 \\[15pt]$$
$H_1 : \sigma_1 \neq \sigma_2$)

```{r FTestDec, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = '60%', fig.align='center', echo=FALSE, fig.cap ="F-Test Decision Table from www.statistics4u.info"}

knitr::include_graphics("images/CH8FTestDec.png")

```

Since we may not always know the population variances, we use the sample variances to infer the equality of the population variances using a two-tailed F-test.  

```{r FCurve, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = '60%', fig.align='center', echo=FALSE, fig.cap ="F-Curve image from www.mtstatic.com"}

knitr::include_graphics("images/CH8FCurve.png")

```

In the calculation, the larger of the two variances is used as the numerator and the smaller of the two variances as the denominator.

$F = \frac {larger S^2}{smaller S^2}$  with $df_{numerator} = r_{larger} -1 , df_{denominator} = r_{smaller} -1$

This calculated F-value can be tested for significance against the critical F-value on the F-distribution table (Appendix XXX).  The degrees of freedom for the two samples are needed to identify the critical F-value on the F-distribution table to determine if the calculated F-value is significant and if our sample variances are equal.  

The results of the F-test will narrow which case to use for calculating the standard error of the difference for our samples. Since this is a two-tailed F-test, the $\alpha$ value to determine the critical F-value, $F_{crit}$, will be divided by two, $\frac{\alpha}{2}$.,

### F-test Decision

If $F_{calc} > F_{crit, \frac{\alpha}{2}}$, then the null hypothesis, $H_0 : \sigma_1 = \sigma_2$), is rejected and the population variances are not equal.

If $F_{calc} < F_{crit, \frac{\alpha}{2}}$, then the null hypothesis, $H_0 : \sigma_1 = \sigma_2$), is not rejected and the population variances are assumed to be equal.


## Calculating $\bar{Y}$, $\bar{d}$, $S^2$, $S_{\bar{d}}$ and the t-statistic

In previous chapters, we used the t-stastic for hypothesis testing within a single population.  The t-statistic can also be used for hypothesis testing between two populations by treating it as a single population consisting of the differences between the two treatments.  

To perform a hypothesis test for two populations, the difference between the two samples averages ($\bar{d}$), the mean of the difference ($\mu_{\bar{d}}$), and the standard error of the difference ($S_{\bar{d}}$) are needed to calculate the t-statistic ($t$).  

$\bar{d} = \bar{Y}_1-\bar{Y}_2$

$\mu_{\bar{d}} = (\mu_1-\mu_2)$

$t = \frac{(\bar{d}-\mu_{\bar{d}})}{S_{\bar{d}}}$

The standard error of the difference will be calculated differently depending on (1) if the samples are independent or paired, (2) if the population variances are equal or unequal and (3) if the sample sizes are equal or unequal.  This presents four unique cases to calculate the standard error of the difference, and 3 unique cases to first calculate the population variance, which are needed to calculate the t-statistic.


### Independent samples with equal population variances : Case 1 (#Case1)

When the two population variances are equal, then the two sample variances are estimates of the same population variance.  To calculate a better estimate of this value, we can average the two sample variances to calculate the pooled sample variance $( S^2 )$ and the standard error of the difference as

$S^2 = \frac{({{S_1}^2})({r_1-1})+({{S_2}^2})({r_2-1})}{(r_1+r_2-2)}$      with     $df = r_1+r_2-2$

$S_{\bar{d}} = [({S}^2)({1/r_1}+{1/r_2})]^{1/2}$ 

When **the two sample sizes are equal**, the pooled variance and the standard error of the difference can more simply be calculated as

$S^2 = \frac{{{S_1}^2}+{{S_2}^2}}{2}$       with     $df = 2(r-1)$

$S_{\bar{d}} = (\frac{{2S}^2}{r})^{1/2}$ 

$t = \frac{\bar{d}-\mu_{\bar{d}}}{S_{\bar{d}}}$


### Independent samples with unequal population variances : Case 2 (#Case2)

When the population variances are unequal, we calculate the standard error of the difference using the known information about the sample variances and sample sizes

$S_{\bar{d}} = (\frac{{S_1}^2}{r_1}+\frac{{S_2}^2}{r_2})^{1/2}$      with     $df = r_1+r_2-2$

$t = \frac{\bar{d}-\mu_{\bar{d}}}{S_{\bar{d}}}$

Since the population variances are unqual, we cannot use the Student t-table to identify the critical t-value ($t_\alpha$).  Therefore, the critical t-value is calculated as

$t_\alpha = \frac{(t_1 S_{\bar{Y_1}}^2+t_2 S_{\bar{Y_2}}^2)}{(S_{\bar{Y_1}}^2+S_{\bar{Y_2}}^2)}$

where $t_1$ and $t_2$ are calculated with $r_1 -1$ and $r_2 -1$ degrees of freedom, respectively.


### Paired samples : Case 3 (#Case3)

When observations are made on the same experimental unit (adjacent plots in the same field, pigs from the same pen) and are assigned to different treatments, they are considered **paired samples**.  The difference between paired averages ($\bar{d}$), the variance of the difference and the standard error of the difference are calculated as

$\bar{d} = \frac{\sum{d_i}}{r}$

$S_d^2 = \frac{\sum(d_i-\bar{d})^2}{r-1}$     with     $df = r-1$

$S_\bar{d} = (\frac{S_d^2}{r})^{1/2}$

$t = \frac{(\bar{d}-\mu_{\bar{d}})}{S_{\bar{d}}}$


<br>
Table: (\#tab:CaseEquations) 

| Case  |  Pop Variances  |  Sample Size  |  Paired/Independent  |                       Sample Variance                           |        Standard Error of the Difference           |      df     |          t-statistic          |
|------:|:---------------:|:-------------:|:--------------------:|:---------------------------------------------------------------:|:-------------------------------------------------:|:-----------:| :-------------------------------------------:|
|   1   |      Equal      |Equal/Not Equal|     Independent      | $\frac{({{S_1}^2})({r_1-1})+({{S_2}^2})({r_2-1})}{(r_1+r_2-2)}$ |       $[({S}^2)({1/r_1}+{1/r_2})]^{1/2}$          | $r_1+r_2-2$ | $\frac{\bar{d}-\mu_{\bar{d}}}{S_{\bar{d}}}$  |
|   1   |      Equal      |     Equal     |     Independent      |              $\frac{{{S_1}^2}+{{S_2}^2}}{2}$                    |           $(\frac{{2S}^2}{r})^{1/2}$              |   $2(r-1)$  | $\frac{(\bar{d}-\mu_{\bar{d}})}{S_{\bar{d}}}$|
|   2   |    Not Equal    |Equal/Not Equal|     Independent      |                                                                 | $(\frac{{S_1}^2}{r_1}+\frac{{S_2}^2}{r_2})^{1/2}$ | $r_1+r_2-2$ |  $\frac{\bar{d}-\mu_{\bar{d}}}{S_{\bar{d}}}$  |
|   3   |      Equal      |     Equal     |       Paired         |          $S_d^2=\frac{\sum(d_i-\bar{d})^2}{r-1}$                |            $(\frac{S_d^2}{r})^{1/2}$              |     $r-1$   | $\frac{(\bar{d}-\mu_{\bar{d}})}{S_{\bar{d}}}$|

<br>



### Confidence Intervals

After identifying the difference between the two samples averages ($\bar{d}$) and the standard error of the difference ($S_{\bar{d}}$), a confidence interval for the mean difference can be calculated to understand the level of confidence associated with the estimated mean difference. 

${L\atop U} = \bar{d} \pm t_\alpha S_\bar{d}$

Note that for Case 1, you will need to calculate the critical t-value (see Case 1 for equation), however for Case 2-4 you can identify this value from the Student t-table (Appendix XXX) with the appropriate degrees of freedom (see appropriate Case for equation). Depending on which case is used to calculate the standard error of the difference, the degrees of freedom to identify the critical t-value ($t_\alpha$) will vary when calculating your confidence intervals. 



## Exercises and Solutions

1. Data is collected on the insecticidal properties of two populations of lima beans, *Phaseolus lunatus*, representing different geographical origins.  Random samples of the two populations, Andean and Mesoamerican, are cultivated in Davis, CA and data is collected on the cyanide content of flower buds. The data is presented in the table below. 

<br>

Table: (\#tab:CrossedFactors) Cyanide content of flower buds (nM HCN) of Andean and Mesoamerican lima beans


| Lima Population   |  Sample Size  |   Mean   |    SD    |
|------------------:|:-------------:|:--------:|:--------:|
| Andean            |       20      |   0.74   |   0.36   |
| Mesoamerican      |       48      |   6.18   |   2.28   |


<br>




Is there a significant difference in yield between the two bean populations, assuming the following conditions:




## Homework : Two Population Means

### Walking Spiders

Wilder and Rypstra (2004) examined the effect of praying mantis excrement on the behavior of wolf spiders to test whether cues from an introduced predator (the praying mantis) would change the movement rate of the native wolf spider. They put 15 wolf spiders in individual containers; inside each container there were two semicircles of filter paper. One semicircle was smeared with praying mantis excrement and one circle was without excrement. The researchers observed each spider for one hour, and calculated spider mean walking speed while it moved across first the excrement circle and then the non-excrement circle. (Each of the 15 spiders was exposed to both treatments). Data were modified for the purpose of homework and are not the original true data.			

```{r}

walking.spiders <- data.frame(
  'Spider Number' = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15),
  'no excrement (cm/sec)' = c(2.5, 5.5, 1.1, 2.7, 2.8, 1.6, 3.2, 4.5, 5.0, 6.9, 2.2, 3.9, 3.8, 3.5, 5.7),
  'excrement (cm/sec)' = c(0.4, 1.9, 1.2, 2.6, 4.3, 0.3, 1.0, 1.5, 3.3, 2.6, 0.7, 1.4, 2.1, 3.4, 2.3),
  'difference' = c(2.1, 3.6, -0.1, 0.1, -1.5, 1.3, 2.2, 3.0, 1.7, 4.3, 1.5, 2.5, 1.7, 0.1, 3.4)) 

```
<br>

Table: (\#tab:WalkingSpiders) The mean walking speed of 15 wolf spiders inside a container in the presence and absence of praying mantis excrement.


| Spider Number   | no excrement (cm/sec) |  excrement (cm/sec)  |    difference    |
|----------------:|:---------------------:|:--------------------:|:----------------:|
|       1         |          2.5          |         0.4          |        2.1       |
|       2         |          5.5          |         1.9          |        3.6       |
|       3         |          1.1          |         1.2          |       -0.1       |
|       4         |          2.7          |         2.6          |        0.1       |
|       5         |          2.8          |         4.3          |       -1.5       |
|       6         |          1.6          |         0.3          |        1.3       |
|       7         |          3.2          |         1.0          |        2.2       |
|       8         |          4.5          |         1.5          |        3.0       |
|       9         |          5.0          |         3.3          |        1.7       |
|       10        |          6.9          |         2.6          |        4.3       |
|       11        |          2.2          |         0.7          |        1.5       |
|       12        |          3.9          |         1.4          |        2.5       |
|       13        |          3.8          |         2.1          |        1.7       |
|       14        |          3.5          |         3.4          |        0.1       |
|       15        |          5.7          |         2.3          |        3.4       |

<br>

1. Calculate the average speed and sample variance for each treatment.

2. Calculate the difference in speed between treatments for each spider. Report the average difference.

3. Calculate the sample variance for the difference between treatments.

4. Calculate the estimated variance of the averages of difference between treatments.

5. Is this a paired or independent sample case?

6. Calculate the t-value that corresponds to the observed difference.

7. Calculate the critical t value to determine if the difference is significant at the 5% level.

8. Calculate a 95% confidence interval for the difference between treatment means.

9. Can you conclude with 95% confidence that mean spider walking speed differed based on cue (praying mantis excrement)?


### Rat Life

Carlson and Hoelzel looked at the average lifespan of a rats based on gender (1946, Journal of Nutrition). Below is lifespan (days) data from 14 male and 14 female rats, you may assume rat lifespan is distributed normally. Data were modified and are not the original true data. Assume variances are the same for males and females.	
```{r}

rat.life <- data.frame(
  'males' = c(700, 825, 425, 500, 575, 725, 800, 475, 575, 725, 500, 700, 575, 775),
  'females' = c(450, 725, 675, 725, 750, 850, 690, 725, 475, 700, 725, 475, 825, 725))

sample.avg <- sapply(rat.life, mean)

sample.var <- sapply(rat.life, var)

```

<br>

Table: (\#tab:InterSteps)

|   rat   |     males     |      females      |    
|--------:|:-------------:|:-----------------:|
|    1    |      700      |        450        |   
|    2    |      825      |        725        |  
|    3    |      425      |        675        |  
|    4    |      500      |        725        |  
|    5    |      575      |        750        |  
|    6    |      725      |        850        |  
|    7    |      800      |        690        |  
|    8    |      475      |        725        |  
|    9    |      575      |        475        |  
|    10   |      725      |        700        |  
|    11   |      500      |        725        |  
|    12   |      700      |        475        |  
|    13   |      575      |        825        |  
|    14   |      775      |        725        |  
|--------:|:-------------:|:-----------------:|
| average |     633.928   |       679.642     | 
|  s.var  |    17269.917  |      15571.016    | 

<br>

Test the hypothesis that lifespan does not differ between sexes.

10. Write the corresponding null and alternative hypothesis.

11. Assume homogeneous variance and calculate the pooled sample variance for rat lifespan.

12. Calculate the estimated variance of the difference between sample averages.

13. Calculate the t value to test for difference between sexes in lifespan. Subtract males from females.

14. Calculate the degrees of freedom of the t value.

15. Calculate the probability of observing a larger absolute value of t if Ho were true.

16. What do you conclude based on whether the calculated p is greater than alpha = 0.05.


## Laboratory Exercises

### Plant Sciences

**Submit BOTH files for your lab report using the appropriate Canvas tool**

For each part and question below, type your code in the grey area below, between the sets of back-ticks (```) to perform the desired computation and get output. Type your answers below the corresponding grey area.

### Part 1 [25 points]

Mass per mature seed (mg) of an invasive grass (medusahead, *Taeniatherum caput-medusae*) was measured when plants were grown in several randomly selected plots of perennial or annual grasses typical of the California Grasslands. The data are included in the R block below. 'A' stands for annual and 'P' for perennial.

Does the variance of seed mass differ between treatments (perennial vs. annual)? Perform a test of hypothesis at the 5% level (α=.05) using the F-statistic. Look up the critical F value in Table A.7 and by using the qf(p = 0.05, df1 = , df2 = ) function.

Complete the calculations "by hand", using only basic R functions like var(). Then, use the var.test () R function to test for difference of variances.


```{r}
seedMassA <- c(5.02, 4.34, 4.17, 7.07, 5.92, 5.33, 5.48, 4.59, 5.47, 5.88, 4.1, 5.14, 4.98, 4.47, 4.26, 5.02, 5.38, 5.3, 4.92, 4.96, 5.86, 6.65, 5.23, 4.51, 5.41, 6.23, 5.96, 5.12, 5.43, 4.98, 5.15, 5.81, 6.14, 5.87, 6.16, 5.97, 6.39, 6.25, 5.3, 5.43, 4.81, 4.76, 6.11, 4.18, 5.59, 5.26, 5.23, 5.9, 6.27, 5.31, 5.17, 4.93, 5.24, 4.96)

seedMassP <- c(4.9, 4.17, 4.47, 6.3, 4.52, 4.81, 4.4, 2.98, 4.75, 5.17, 4.64, 4.7, 5.13, 5.11, 5.33, 4.3, 4.24, 4.49, 4.46, 5.06, 4.62, 5.58, 4.39, 4.77, 5.18, 4.38, 4.76, 4.38, 4.95, 5.71, 3.03, 4.2, 4.78, 5.04, 4.76, 4.72, 4.87, 4.58, 4.69, 4.27, 5.17, 4.93, 3.51, 5.11, 5.38, 5.1, 3.2, 4.8, 4.17, 5.01, 3.95, 5.62, 5.44, 3.7, 4.08, 4.36, 4.68, 4.24)

(varA <- var(seedMassA))

(varP <- var(seedMassP))

var.test(seedMassA, seedMassP) # R function that does the complete test

(Fcalc <- varA / varP)

(r1 <- length(seedMassA))

(r2 <- length(seedMassP))

(df1 <- r1 - 1)

(df2 <- r2 - 1)

alpha <- 0.05

(Ftable <- qf(alpha, df1, df2, lower.tail = FALSE))

(p.of.Fcalc <- 2 * pf(Fcalc, df1, df2, lower.tail = FALSE)) # complete the code to get the observed significance

# The probability is multiplied by 2 because the test is two-tailed.
```

ANSWER. Write the interpretation and conclusion from the test here:





### Part 2 [30 points]

Calculate the 95% confidence interval for the difference between the mean mass per seed of plants grown in annual and perennial grass plots. *Ignore the possibility of using the z-approximation due to the large sample size and use the t distribution.*

a. Based on the results of the test of equality of variances, determine what case (SG pg. 88) applies and estimate the variance of the difference between averages. Then compute the confidence interval.

b. Perform a t-test of the null hypothesis that the mass per seed does not differ between plants grown in annual or perennial grass plots. Perform all calculations "by hand" and compare to the results from using the t.test() function.


```{r}

(varAP <- (df1 * varA + df2 * varP) / (df1 + df2))

varDbar <- varAP / r1 + varAP/ r2

(tcalc <- (mean(seedMassA) - mean(seedMassP)) / sqrt(varDbar))

(ttable <- qt(alpha / 2, df = df1 + df2, lower.tail = FALSE)) # test is two-tailed

(CI.lo <- (mean(seedMassA) - mean(seedMassP)) - ttable * sqrt(varDbar))
(CI.hi <- (mean(seedMassA) - mean(seedMassP)) + ttable * sqrt(varDbar))

(t.test.1 <- t.test(seedMassA, seedMassP, alternative = "two.sided", paired = FALSE, var.equal = TRUE)) # complete code

```

ANSWER. State the extremes of the confidence interval and interpret the result of the test of hypothesis here:







### Part 3 [30 points]

Twelve plants were used in an experiment to study the effectiveness of using praying mantises to control aphid populations. Aphid density was measured before and after the addition of a mantis to the plant. Perform a test to determine if the mantis reduces aphid density. (Note that these are fictitious data and that the experimental design is simplified for teaching purposes. A real experiment should include a series of control plants to make sure that the potential change in aphid density is not due to other uncontrolled causes besides the addition of the mantis).


```{r}

aphids <- read.csv("Aphids.txt", header = TRUE)

before <- aphids$before

after <- aphids$after

(t.test.2 <- t.test(before, after, alternative = "greater", paired = TRUE)) # complete code

# repeat the test using "hand" calculations as in part 2 above. Add lines of code below.

d <- after - before

var.d <- var(d)

se.d.bar <- sqrt(var.d /   )

dfs <- 

t.calc.d <- (mean(d) - 0) / se.d.bar

ttable <- qt(alpha / 2, df =     , lower.tail = FALSE)


```

ANSWER. Interpret the result of the test of hypothesis here:



### Part 4: Paired or independent? [15 points]

For the following situations please determine if you should be conducting an independent or a paired t-test. Make sure to justify your answers!  In some of these situations multiple pieces of information are being collected so please indicate what groups/variables are being compared.

#### A. A researcher is interested in whether the presence of natural enemies significantly reduces herbivory from the invasive pest soybean aphid (Aphis glycines). She randomly chooses 36 individual soybean plants in 4 fields to measure. As a proxy for herbivory, she counts the number of soybean aphids on each plant. She then encloses half of the plants with a mesh exclusion cage, through which aphids can pass but large predatory insects cannot. After two weeks, she counts aphids on all 36 plants again, and determines the net change in aphid abundance under each treatment.

Answer here:



#### B. A master gardener wants to know whether his decision to use organic compost instead of synthetic fertilizer is going to change the yield of his broccoli. To test this, he applies a consistent amount of fertilizer or compost to the soil in each of six plots in a random design (3 receive compost, 3 receive fertilizer). He then plants the same variety of broccoli in all plots and measures the average yield (grams of broccoli head per plant) at harvest for each treatment.

Answer here:




#### C. You have developed a new cultivar of habanero chili (Capsicum chinense) that you have named "Screaming Siren". You are curious if the chilies produced at your breeding facility differ in spice from a colleague's farm in New Mexico. Both you and your colleague gather a sample of 10 random chilies and send the chilies to a lab to have their capsaicin, the compound in chilies that cause their piquancy, concentration measured. 

Answer here:




#### D. A medical research program is evaluating the efficacy of two natural ingredients, fish oil and niacin (vitamin B3), on blood triglyceride level. You wish to know if the ingredients differ in effect on blood triglycerides. Forty patients had their blood triglyceride levels measured before the experiment began. The forty patients were divided into two treatment groups of twenty patients. One treatment group received 4 grams of fish oil per day, the other received 1 gram of niacin per day.  After 30 days the patients had their blood triglyceride level measured.


Answer here:




#### E. A researcher is interested in determining the difference in plant species composition after seeding with native perennial seeds. Before seeding they sample quadrats within the field at random to determine the initial plant species composition. At the end of the second growing season they sample quadrats within the field at random to determine the new plant species composition.

Answer here:




### Animal Sciences

**Submit BOTH files for your lab report using the appropriate Canvas tool**

For each part and question below, type your code in the grey area below, between the sets of back-ticks (```) to perform the desired computation and get output. Type your answers below the corresponding grey area.


```{r}
### Part 1 [25 points]

Milk production (lb), milk composition and body weights of UCD lactating dairy cows was collected in August of 2000.  The cows are classified in two groups, Herd1 and Herd2, based on their genotype.

Does the variance of milk production differ between the two herds (Herd1 vs. Herd2)? Perform a test of hypothesis at the 5% level (α=.05) using the F-statistic. Look up the critical F value in Table A.7 and by using the qf(p = 0.05, df1 = , df2 = ) function.

Complete the calculations "by hand", using only basic R functions like var(). Then, use the var.test () R function to test for difference of variances.


library(readxl)
MilkData <- read.csv("C:/MilkEx5_data.csv")

herd1 <- subset(MilkData, HERD == 1)
milkherd1 <- herd1$TOTmilk
herd2 <- subset(MilkData, HERD == 2)
milkherd2 <- herd2$TOTmilk

## Test for the difference of variances "by hand"

#calculate the variance for each treatment (Herd1 and Herd2)
(var1 <- var(milkherd1))
(var2 <- var(milkherd2))

#calculate the F-value for our treatments (the larger variance will always be the numerator)
(Fcalc <- var1 / var2)

#number of samples in each treatment
(r1 <- length(milkherd1))
(r2 <- length(milkherd2))

#degrees of freedom: number of samples - 1
(df1 <- r1 - 1)
(df2 <- r2 - 1)

alpha <- 0.05

#calculate the critical F-value (for our given alpha and degrees of freedom)
(Ftable <- qf(alpha, df1, df2, lower.tail = FALSE))

#Calculate the p-value of our treatment variances being equal (the probability is multiplied by 2 because the test is two-tailed)
# complete the code to get the observed significance
(p.of.Fcalc <- 2 * pf(Fcalc, df1, df2, lower.tail = FALSE)) 


##R function that does the complete test
var.test(milkherd1, milkherd2) 
```

ANSWER 1.
Write the interpretation and conclusion from the test here:




```{r}
### Part 2 [30 points]

Calculate the 95% confidence interval for the difference between the milk production of dairy cows between the two herds. *Ignore the possibility of using the z-approximation due to the large sample size and use the t distribution.*

a. Based on the results of the test of equality of variances, determine what case (SG pg. 88) applies and estimate the variance of the difference between averages. Then compute the confidence interval.

b. Perform a t-test of the null hypothesis that milk production does not differ between diary cows from Herd1 and Herd2. Perform all calculations "by hand" and compare to the results from using the t.test() function.


```{r}
#Calculate the pooled variance of Herd1 and Herd2
(var12 <- (df1 * var1 + df2 * var2) / (df1 + df2))

#Calculate the difference in variances between Herd1 and Herd2
varDbar <- var12 / r1 + var12/ r2

#calculate the t-value for our treatments (Herd1 and Herd2)
(tcalc <- (mean(milkherd2) - mean(milkherd1)) / sqrt(varDbar))

#calculate the critical t-value (for our given alpha and degrees of freedom)
(ttable <- qt(alpha / 2, df = df1 + df2, lower.tail = FALSE)) # test is two-tailed

#calculate the bounds of the critical intervals for the difference between our two treatments
(CI.lo <- (mean(milkherd1) - mean(milkherd2)) - ttable * sqrt(varDbar))
(CI.hi <- (mean(milkherd1) - mean(milkherd2)) + ttable * sqrt(varDbar))


(t.test.herd <- t.test(milkherd1, milkherd2, alternative = "two.sided", paired = FALSE, var.equal = TRUE)) # complete code

```

ANSWER. State the extremes of the confidence interval and interpret the result of the test of hypothesis here:







### Part 3 [30 points]

Milk production was measured in the morning (AM) and again in the evening (PM).  Perform a test to determine if there is a difference in milk production between the AM and PM. (Note that this is a paired t-test since the same sample of cows is being milk at two separate times).


```{r}
milkAM <- MilkData$AMmilk

milkPM <- MilkData$PMmilk

# repeat the test using "hand" calculations as in part 2 above. Add lines of code below.

#difference between the means of milk treatments (AM vs PM)
d <- milkPM - milkAM

#difference between the variances of milk treatments
var.d <- var(d)

#standard error of the difference between milk treatments 
se.d.bar <- sqrt(var.d /   )

dfs <- 

#calculated t-value for the difference between milk treatments
t.calc.d <- (mean(d) - 0) / se.d.bar

#critical t-value (for a given alpha and degrees of freedom)
ttable <- qt(alpha / 2, df =     , lower.tail = FALSE)


#complete missing code for t-test between milking times (AM vs PM)
(t.test.time <- t.test(milkPM, milkAM, alternative = "greater", paired = TRUE)) 
```

ANSWER. Interpret the result of the test of hypothesis here:



### Part 4: Paired or independent? [15 points]

For the following situations please determine if you should be conducting an independent or a paired t-test. Make sure to justify your answers!  In some of these situations multiple pieces of information are being collected so please indicate what groups/variables are being compared.

#### A. A researcher is interested in whether a high protein diet for dairy cows will significantly increase the protein content in milk.  36 dairy cows are randomly chosen in 4 fields to measure and the protein content of their milk is measured.  Half of the cows are chosen to receive a high protein diet and half recieve the standard diet.  After two weeks, protein content of milk production is measured again, and the change in protein content is calculated for each treatment.

Answer here:



#### B. A researcher wants to know whether using organic diary feed will change the milk production of his cows.  To test this, organic feed and non-organic feed is given to six cows of the same breed in a random design (3 receive organic feed, 3 receive non-organic feed) and dairy production is measured for each treatment.  


Answer here:




#### C. You have developed a new breed of dairy cows that you have named "Cowabunga".  You are curious if the milk produced from these cows at your facility in Davis differ in lactose content from a colleagues farm in Fresno.  Both you and your colleague gather a sample of 10 random cows and send the milk to a lab to have their lactose content measured.  

Answer here:




#### D. A medical research program is evaluating the efficacy of two natural ingredients, fish oil and niacin (vitamin B3) on blood triglyceride level in diary cows.  You wish to know if the ingredients differ in effect on blood triglycerides.  Forty cows had their blood triglyceride levels measured before the experiment began.  The forty cows were divided into two treatment groups of twenty cows.  One treatment group received 4 grams of fish oil per day, the other received 1 gram of niacin per day.  After 30 days the cows had their blood triglyceride level measured.  

Answer here:




#### E. A research is interested in determining the difference in bacteria species composition in the rumen of a cow after changing the grazing location from one year to the next.  At the first grazing location they sample gut bacteria within a herd at random to determine the initial rumen bacteria composition.  At the end of the year at the second grazing location they sample rumen bacteria within the herd at random to determine the new bacteria species composition.  

Answer here:





